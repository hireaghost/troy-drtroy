<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Debug - DrTroy.com</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .debug-card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .success { background: #dcfce7; color: #065f46; }
        .error { background: #fef2f2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        .data-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        button {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        button:hover {
            background: #1e40af;
        }
        .danger {
            background: #dc2626;
        }
        .danger:hover {
            background: #b91c1c;
        }
        h1 {
            color: #1e3a8a;
        }
        h2 {
            color: #1e40af;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <h1>üîç DrTroy.com Account Debug Tool</h1>
    <p>This tool helps diagnose login and account issues on the platform.</p>
    
    <div class="debug-card">
        <h2>üìä Current Authentication Status</h2>
        <div id="authStatus"></div>
        <button onclick="refreshStatus()">üîÑ Refresh Status</button>
        <button onclick="viewData()">üëÅÔ∏è View Account Data</button>
    </div>
    
    <div class="debug-card">
        <h2>üë§ Account Data</h2>
        <div id="accountData"></div>
        <button onclick="exportAccountData()">üì• Export Account Data</button>
    </div>
    
    <div class="debug-card">
        <h2>üîê Session Data</h2>
        <div id="sessionData"></div>
        <button onclick="extendSession()">‚è∞ Extend Session</button>
    </div>
    
    <div class="debug-card">
        <h2>üõ†Ô∏è Quick Fixes</h2>
        <button onclick="createTestAccount()">üë§ Create Test Account</button>
        <button onclick="fixLoginSession()">üîß Fix Login Session</button>
        <button onclick="clearAllData()" class="danger">üóëÔ∏è Clear All Data</button>
    </div>
    
    <div class="debug-card">
        <h2>üöÄ Navigation</h2>
        <button onclick="goToHomePage()">üè† Go to Home Page</button>
        <button onclick="goToMyAccount()">üë§ Go to My Account</button>
        <button onclick="goToAdmin()">‚öôÔ∏è Go to Admin Panel</button>
    </div>

    <script>
        function refreshStatus() {
            const hasAccount = localStorage.getItem('drtroyAccount');
            const hasSession = localStorage.getItem('userSession');
            
            let status = '';
            
            if (hasAccount && hasSession) {
                status += '<div class="status success">‚úÖ LOGGED IN - Account and session found</div>';
                try {
                    const account = JSON.parse(hasAccount);
                    const session = JSON.parse(hasSession);
                    status += `<p><strong>Name:</strong> ${account.firstName} ${account.lastName}</p>`;
                    status += `<p><strong>Email:</strong> ${account.email}</p>`;
                    status += `<p><strong>Discipline:</strong> ${account.discipline}</p>`;
                    status += `<p><strong>Session Valid:</strong> ${session.expires > Date.now() ? 'Yes' : 'EXPIRED'}</p>`;
                } catch (e) {
                    status += '<div class="status error">‚ùå ERROR - Account/session data is corrupted</div>';
                }
            } else if (hasAccount && !hasSession) {
                status += '<div class="status warning">‚ö†Ô∏è ACCOUNT EXISTS but NO SESSION - Need to log in again</div>';
                try {
                    const account = JSON.parse(hasAccount);
                    status += `<p><strong>Account Email:</strong> ${account.email}</p>`;
                } catch (e) {
                    status += '<div class="status error">‚ùå Account data is corrupted</div>';
                }
            } else if (!hasAccount && hasSession) {
                status += '<div class="status warning">‚ö†Ô∏è SESSION EXISTS but NO ACCOUNT - Data mismatch</div>';
            } else {
                status += '<div class="status error">‚ùå NOT LOGGED IN - No account or session data found</div>';
            }
            
            document.getElementById('authStatus').innerHTML = status;
        }
        
        function viewData() {
            const accountData = localStorage.getItem('drtroyAccount');
            const sessionData = localStorage.getItem('userSession');
            
            let accountDisplay = 'No account data found';
            let sessionDisplay = 'No session data found';
            
            if (accountData) {
                try {
                    const account = JSON.parse(accountData);
                    accountDisplay = JSON.stringify(account, null, 2);
                } catch (e) {
                    accountDisplay = 'CORRUPTED: ' + accountData;
                }
            }
            
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    sessionDisplay = JSON.stringify(session, null, 2);
                } catch (e) {
                    sessionDisplay = 'CORRUPTED: ' + sessionData;
                }
            }
            
            document.getElementById('accountData').innerHTML = '<div class="data-box">' + accountDisplay + '</div>';
            document.getElementById('sessionData').innerHTML = '<div class="data-box">' + sessionDisplay + '</div>';
        }
        
        function createTestAccount() {
            const testAccount = {
                id: 'test_' + Date.now(),
                firstName: 'Troy',
                lastName: 'Hounshell',
                email: 'troyh@texastherapypros.com',
                password: 'DrTroy2026!',
                discipline: 'PT',
                phone: '806-577-6908',
                createdAt: new Date().toISOString(),
                licenseRenewalReminders: true
            };
            
            const testSession = {
                userId: testAccount.id,
                email: testAccount.email,
                loginTime: Date.now(),
                expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
            };
            
            localStorage.setItem('drtroyAccount', JSON.stringify(testAccount));
            localStorage.setItem('userSession', JSON.stringify(testSession));
            localStorage.setItem('customerName', 'Troy Hounshell');
            localStorage.setItem('customerEmail', 'troyh@texastherapypros.com');
            localStorage.setItem('customerDiscipline', 'PT');
            
            alert('‚úÖ Test account created successfully!\n\nEmail: troyh@texastherapypros.com\nPassword: DrTroy2026!');
            refreshStatus();
            viewData();
        }
        
        function fixLoginSession() {
            const accountData = localStorage.getItem('drtroyAccount');
            
            if (!accountData) {
                alert('‚ùå No account found. Create a test account first.');
                return;
            }
            
            try {
                const account = JSON.parse(accountData);
                
                const session = {
                    userId: account.id || 'user_' + Date.now(),
                    email: account.email,
                    loginTime: Date.now(),
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000)
                };
                
                localStorage.setItem('userSession', JSON.stringify(session));
                localStorage.setItem('customerName', (account.firstName || 'User') + ' ' + (account.lastName || ''));
                localStorage.setItem('customerEmail', account.email);
                if (account.discipline) localStorage.setItem('customerDiscipline', account.discipline);
                
                alert('‚úÖ Login session fixed!');
                refreshStatus();
                viewData();
            } catch (e) {
                alert('‚ùå Error fixing session: ' + e.message);
            }
        }
        
        function extendSession() {
            const sessionData = localStorage.getItem('userSession');
            
            if (!sessionData) {
                alert('‚ùå No session found.');
                return;
            }
            
            try {
                const session = JSON.parse(sessionData);
                session.expires = Date.now() + (7 * 24 * 60 * 60 * 1000);
                localStorage.setItem('userSession', JSON.stringify(session));
                
                alert('‚úÖ Session extended for 7 days!');
                refreshStatus();
                viewData();
            } catch (e) {
                alert('‚ùå Error extending session: ' + e.message);
            }
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will delete ALL account data and log you out. Are you sure?')) {
                localStorage.removeItem('drtroyAccount');
                localStorage.removeItem('userSession');
                localStorage.removeItem('customerName');
                localStorage.removeItem('customerEmail');
                localStorage.removeItem('customerDiscipline');
                localStorage.removeItem('selectedPackage');
                localStorage.removeItem('packagePrice');
                localStorage.removeItem('selectedPackageCode');
                localStorage.removeItem('currentAccountTab');
                
                alert('‚úÖ All data cleared!');
                refreshStatus();
                viewData();
            }
        }
        
        function exportAccountData() {
            const accountData = localStorage.getItem('drtroyAccount');
            const sessionData = localStorage.getItem('userSession');
            
            const exportData = {
                account: accountData ? JSON.parse(accountData) : null,
                session: sessionData ? JSON.parse(sessionData) : null,
                exported: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'drtroy-account-debug-' + Date.now() + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function goToHomePage() {
            window.open('index.html', '_blank');
        }
        
        function goToMyAccount() {
            window.open('my-account.html', '_blank');
        }
        
        function goToAdmin() {
            window.open('secure-admin-access-2026.html', '_blank');
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            viewData();
        });
    </script>
</body>
</html>
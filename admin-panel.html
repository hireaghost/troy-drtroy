<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrTroy.com - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navy: #1e3a8a;
            --gold: #f59e0b;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-900: #111827;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gray-100);
            min-height: 100vh;
        }

        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: var(--navy);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .status-badge {
            background: #d4e6f1;
            color: #1e3a8a;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .main-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: white;
            padding: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .main-nav-tab {
            background: transparent;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: var(--gray-600);
        }

        .main-nav-tab.active {
            background: var(--navy);
            color: white;
        }

        .main-nav-tab:hover:not(.active) {
            background: var(--gray-100);
        }

        .main-tab-content {
            display: none;
        }

        .main-tab-content.active {
            display: block;
        }

        .admin-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem 2rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            color: var(--navy);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
        }

        .stat-card {
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .code-tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--gray-100);
            padding: 0.25rem;
            border-radius: 6px;
            margin-bottom: 2rem;
        }

        .code-tab {
            background: transparent;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: var(--gray-600);
            flex: 1;
        }

        .code-tab.active {
            background: white;
            color: var(--navy);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .code-tab-content {
            display: none;
        }

        .code-tab-content.active {
            display: block;
        }

        .form-section {
            padding: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .btn-primary {
            background: var(--navy);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: #1e40af;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-900);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .codes-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .codes-table th,
        .codes-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .codes-table th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-900);
        }

        .codes-table tr:hover {
            background: var(--gray-50);
        }

        .success-message {
            background: #d4e6f1;
            color: #1e3a8a;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-weight: 600;
            display: none;
        }

        .analytics-tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--gray-100);
            padding: 0.25rem;
            border-radius: 6px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .analytics-tab {
            background: transparent;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .analytics-tab.active {
            background: white;
            color: var(--navy);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .analytics-content {
            display: none;
        }

        .analytics-content.active {
            display: block;
        }

        .metric-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-info h3 {
            color: var(--navy);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .metric-info p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .info-box {
            background: #fff3cd;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }

        .code-type-info {
            background: var(--gray-100);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .main-nav {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DrTroy.com Admin Panel</h1>
        <div class="status-badge">‚úÖ Direct Access Mode</div>
    </div>

    <div class="container">
        <!-- Main Navigation -->
        <div class="main-nav">
            <button class="main-nav-tab active" onclick="switchMainTab('codes')">üí∞ Discount Codes</button>
            <button class="main-nav-tab" onclick="switchMainTab('analytics')">üìä Analytics</button>
            <button class="main-nav-tab" onclick="switchMainTab('settings')">‚öôÔ∏è Settings</button>
        </div>

        <!-- Discount Codes Tab -->
        <div id="codes-tab" class="main-tab-content active">
            <!-- Stats Overview -->
            <div class="admin-card">
                <div class="card-header">
                    <h2 class="card-title">Discount Code Overview</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalCodes">0</div>
                        <div class="stat-label">Total Codes Created</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeCodes">0</div>
                        <div class="stat-label">Active Codes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="usedCodes">0</div>
                        <div class="stat-label">Total Uses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSavings">$0</div>
                        <div class="stat-label">Customer Savings</div>
                    </div>
                </div>
            </div>

            <!-- Code Creation -->
            <div class="admin-card">
                <div class="card-header">
                    <h2 class="card-title">Create Discount Codes</h2>
                </div>
                
                <div style="padding: 2rem;">
                    <!-- Code Type Tabs -->
                    <div class="code-tabs">
                        <button class="code-tab active" onclick="switchCodeTab('employee')">üè¢ Employee Codes</button>
                        <button class="code-tab" onclick="switchCodeTab('marketing')">üì¢ Marketing Codes</button>
                    </div>

                    <!-- Employee Code Form -->
                    <div id="employee-code-content" class="code-tab-content active">
                        <div class="code-type-info">
                            <strong>Employee Codes:</strong> One-time use discount codes for your staff members. Each code provides 100% discount on the selected package type.
                        </div>
                        
                        <form id="employeeForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Employee Name</label>
                                    <input type="text" id="employeeName" class="form-input" placeholder="Sarah Johnson" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Employee Type</label>
                                    <select id="employeeType" class="form-select" required>
                                        <option value="">Select type</option>
                                        <option value="staff">Staff Member</option>
                                        <option value="contractor">Contractor</option>
                                        <option value="partner">Partner</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Package Type</label>
                                    <select id="employeePackage" class="form-select" required>
                                        <option value="">Select package</option>
                                        <option value="PT">Physical Therapists ($109)</option>
                                        <option value="PTA">Physical Therapist Assistants ($89)</option>
                                        <option value="OT">Occupational Therapists ($109)</option>
                                        <option value="COTA">Certified Occupational Therapy Assistants ($89)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notes (Optional)</label>
                                <input type="text" id="employeeNotes" class="form-input" placeholder="Additional notes about this code">
                            </div>
                            
                            <button type="submit" class="btn-primary">üé´ Generate Employee Code</button>
                        </form>
                    </div>

                    <!-- Marketing Code Form -->
                    <div id="marketing-code-content" class="code-tab-content">
                        <div class="code-type-info">
                            <strong>Marketing Codes:</strong> Flexible discount codes for promotions, campaigns, and customer acquisition.<br>
                            <small>Examples: SPRING25 (25% off), SAVE20 ($20 off), FREEPT (100% free for PTs), WELCOME (50 uses max)</small>
                        </div>
                        
                        <form id="marketingForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Code Name</label>
                                    <input type="text" id="marketingCodeName" class="form-input" placeholder="SPRING25" style="text-transform: uppercase;" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Discount Type</label>
                                    <select id="marketingDiscountType" class="form-select" required>
                                        <option value="">Select type</option>
                                        <option value="percentage">Percentage Off</option>
                                        <option value="fixed">Fixed Amount Off</option>
                                        <option value="free">100% Free</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Discount Value</label>
                                    <input type="number" id="marketingDiscountValue" class="form-input" placeholder="25" min="0" max="100">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Usage Limit</label>
                                    <select id="marketingUsageType" class="form-select" required>
                                        <option value="unlimited">Unlimited Uses</option>
                                        <option value="limited">Limited Uses</option>
                                        <option value="single">Single Use</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Max Uses (if limited)</label>
                                    <input type="number" id="marketingMaxUses" class="form-input" placeholder="50" min="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Expiry Date (Optional)</label>
                                    <input type="date" id="marketingExpiry" class="form-input">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Campaign Name</label>
                                <input type="text" id="marketingCampaign" class="form-input" placeholder="Spring 2026 Promotion">
                            </div>
                            
                            <button type="submit" class="btn-primary">üöÄ Create Marketing Code</button>
                        </form>
                    </div>

                    <div id="codeSuccess" class="success-message"></div>
                </div>
            </div>

            <!-- All Codes Table -->
            <div class="admin-card">
                <div class="card-header">
                    <h2 class="card-title">All Discount Codes</h2>
                </div>
                
                <div style="padding: 2rem; overflow-x: auto;">
                    <table class="codes-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Type</th>
                                <th>Discount</th>
                                <th>Uses</th>
                                <th>Applies To</th>
                                <th>Expires</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="codesTableBody">
                            <!-- Codes will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="main-tab-content">
            <div class="admin-card">
                <div class="card-header">
                    <h2 class="card-title">Business Analytics Dashboard</h2>
                </div>
                
                <div style="padding: 2rem;">
                    <!-- Analytics Tabs -->
                    <div class="analytics-tabs">
                        <button class="analytics-tab active" onclick="switchAnalyticsTab('essential')">Essential</button>
                        <button class="analytics-tab" onclick="switchAnalyticsTab('revenue')">Revenue</button>
                        <button class="analytics-tab" onclick="switchAnalyticsTab('customers')">Customers</button>
                        <button class="analytics-tab" onclick="switchAnalyticsTab('marketing')">Marketing</button>
                        <button class="analytics-tab" onclick="switchAnalyticsTab('operations')">Operations</button>
                    </div>

                    <!-- Essential Analytics -->
                    <div id="essential-analytics" class="analytics-content active">
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Monthly Revenue</h3>
                                <p>Total revenue from course sales this month</p>
                            </div>
                            <div class="metric-value" id="monthlyRevenue">$0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Active Customers</h3>
                                <p>Total customers with active accounts</p>
                            </div>
                            <div class="metric-value" id="activeCustomers">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Course Completion Rate</h3>
                                <p>Percentage of customers completing courses</p>
                            </div>
                            <div class="metric-value" id="completionRate">0%</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Average Revenue Per User</h3>
                                <p>Average revenue generated per customer</p>
                            </div>
                            <div class="metric-value" id="arpu">$0</div>
                        </div>
                    </div>

                    <!-- Revenue Analytics -->
                    <div id="revenue-analytics" class="analytics-content">
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Total Revenue</h3>
                                <p>All-time revenue from platform</p>
                            </div>
                            <div class="metric-value" id="totalRevenue">$0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>PT Package Revenue</h3>
                                <p>Revenue from Physical Therapist packages</p>
                            </div>
                            <div class="metric-value" id="ptRevenue">$0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>OT Package Revenue</h3>
                                <p>Revenue from Occupational Therapist packages</p>
                            </div>
                            <div class="metric-value" id="otRevenue">$0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Discount Savings</h3>
                                <p>Total savings provided to customers</p>
                            </div>
                            <div class="metric-value" id="totalDiscountSavings">$0</div>
                        </div>
                    </div>

                    <!-- Customer Analytics -->
                    <div id="customers-analytics" class="analytics-content">
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Total Customers</h3>
                                <p>All customers who have created accounts</p>
                            </div>
                            <div class="metric-value" id="totalCustomers">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>New Customers This Month</h3>
                                <p>Customer acquisition this month</p>
                            </div>
                            <div class="metric-value" id="newCustomers">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Customer Retention Rate</h3>
                                <p>Percentage of customers returning</p>
                            </div>
                            <div class="metric-value" id="retentionRate">0%</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Most Popular Package</h3>
                                <p>Best-selling course package</p>
                            </div>
                            <div class="metric-value" id="popularPackage">PT</div>
                        </div>
                    </div>

                    <!-- Marketing Analytics -->
                    <div id="marketing-analytics" class="analytics-content">
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Discount Code Usage</h3>
                                <p>Percentage of sales using discount codes</p>
                            </div>
                            <div class="metric-value" id="discountUsage">0%</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Most Effective Code</h3>
                                <p>Discount code with highest usage</p>
                            </div>
                            <div class="metric-value" id="topCode">-</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Marketing Conversion Rate</h3>
                                <p>Visitors who use discount codes</p>
                            </div>
                            <div class="metric-value" id="marketingConversion">0%</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Employee Code Redemption</h3>
                                <p>Staff codes that have been used</p>
                            </div>
                            <div class="metric-value" id="employeeRedemption">0%</div>
                        </div>
                    </div>

                    <!-- Operations Analytics -->
                    <div id="operations-analytics" class="analytics-content">
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Platform Uptime</h3>
                                <p>System availability percentage</p>
                            </div>
                            <div class="metric-value" id="uptime">99.9%</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Average Page Load Time</h3>
                                <p>Website performance metric</p>
                            </div>
                            <div class="metric-value" id="loadTime">1.2s</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>Support Tickets</h3>
                                <p>Open customer support requests</p>
                            </div>
                            <div class="metric-value" id="supportTickets">0</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-info">
                                <h3>System Health Score</h3>
                                <p>Overall platform health rating</p>
                            </div>
                            <div class="metric-value" id="healthScore">A+</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="main-tab-content">
            <div class="admin-card">
                <div class="card-header">
                    <h2 class="card-title">Admin Settings</h2>
                </div>
                
                <div class="form-section">
                    <div class="info-box">
                        <strong>üîí Admin Panel Settings:</strong> Manage your admin credentials and system preferences. Changes will be applied immediately.
                    </div>

                    <h3 style="margin-bottom: 1rem; color: var(--navy);">Account Management</h3>
                    
                    <form id="settingsForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Admin Username</label>
                                <input type="text" id="adminUsername" class="form-input" value="troyhounshell">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email Notifications</label>
                            <select id="emailNotifications" class="form-select">
                                <option value="all">All Notifications</option>
                                <option value="important">Important Only</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-primary">üíæ Save Settings</button>
                    </form>
                    
                    <div id="settingsSuccess" class="success-message"></div>

                    <h3 style="margin: 2rem 0 1rem; color: var(--navy);">Data Management</h3>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button onclick="exportAllData()" class="btn-secondary">üì• Export All Data</button>
                        <button onclick="clearAnalytics()" class="btn-secondary">üßπ Clear Analytics</button>
                        <button onclick="resetCodes()" class="btn-secondary">üîÑ Reset Sample Codes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for data storage
        let employeeCodes = [];
        let marketingCodes = [];
        let analytics = {};

        // Initialize the admin panel
        function initializeAdmin() {
            console.log('üöÄ Initializing DrTroy Admin Panel...');
            
            // Load existing data
            loadStoredData();
            
            // Create sample data if needed
            createSampleData();
            
            // Update displays
            updateCodeStats();
            updateCodesTable();
            updateAnalytics();
            
            console.log('‚úÖ Admin panel initialized successfully');
        }

        // Load data from localStorage
        function loadStoredData() {
            try {
                employeeCodes = JSON.parse(localStorage.getItem('drTroyEmployeeCodes') || '[]');
                marketingCodes = JSON.parse(localStorage.getItem('drTroyMarketingCodes') || '[]');
                analytics = JSON.parse(localStorage.getItem('drTroyAnalytics') || '{}');
            } catch (error) {
                console.warn('Error loading stored data:', error);
                employeeCodes = [];
                marketingCodes = [];
                analytics = {};
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('drTroyEmployeeCodes', JSON.stringify(employeeCodes));
            localStorage.setItem('drTroyMarketingCodes', JSON.stringify(marketingCodes));
            localStorage.setItem('drTroyAnalytics', JSON.stringify(analytics));
        }

        // Create sample data if none exists
        function createSampleData() {
            if (employeeCodes.length === 0) {
                employeeCodes = [
                    {
                        code: 'EMP-PT001',
                        employeeName: 'Sarah Johnson',
                        employeeType: 'staff',
                        packageType: 'PT',
                        packagePrice: 109,
                        status: 'active',
                        created: new Date().toISOString(),
                        used: false
                    },
                    {
                        code: 'EMP-OT002',
                        employeeName: 'Mike Chen',
                        employeeType: 'contractor',
                        packageType: 'OT',
                        packagePrice: 109,
                        status: 'used',
                        created: new Date(Date.now() - 86400000).toISOString(),
                        used: true,
                        usedDate: new Date().toISOString()
                    }
                ];
            }

            if (marketingCodes.length === 0) {
                marketingCodes = [
                    {
                        code: 'SPRING25',
                        discountType: 'percentage',
                        discountValue: 25,
                        usageType: 'unlimited',
                        maxUses: null,
                        currentUses: 12,
                        campaign: 'Spring 2026 Promotion',
                        status: 'active',
                        created: new Date().toISOString(),
                        expires: null
                    },
                    {
                        code: 'SAVE20',
                        discountType: 'fixed',
                        discountValue: 20,
                        usageType: 'limited',
                        maxUses: 100,
                        currentUses: 34,
                        campaign: 'General Discount',
                        status: 'active',
                        created: new Date(Date.now() - 172800000).toISOString(),
                        expires: null
                    },
                    {
                        code: 'FREEPT',
                        discountType: 'free',
                        discountValue: 100,
                        usageType: 'limited',
                        maxUses: 25,
                        currentUses: 8,
                        campaign: 'PT Professional Outreach',
                        status: 'active',
                        created: new Date(Date.now() - 259200000).toISOString(),
                        expires: null
                    }
                ];
            }

            saveData();
        }

        // Main tab switching
        function switchMainTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.main-nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.main-tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            console.log('Switched to main tab:', tabName);

            // Update analytics if switching to analytics tab
            if (tabName === 'analytics') {
                updateAnalytics();
            }
        }

        // Code tab switching
        function switchCodeTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.code-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.code-tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-code-content').classList.add('active');
            
            console.log('Switched to code tab:', tabName);
        }

        // Analytics tab switching
        function switchAnalyticsTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.analytics-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.analytics-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-analytics').classList.add('active');
            
            console.log('Switched to analytics tab:', tabName);
        }

        // Update code statistics
        function updateCodeStats() {
            const totalCodes = employeeCodes.length + marketingCodes.length;
            const activeCodes = employeeCodes.filter(c => c.status === 'active').length + 
                              marketingCodes.filter(c => c.status === 'active').length;
            const usedCount = employeeCodes.filter(c => c.used).length + 
                            marketingCodes.reduce((sum, c) => sum + (c.currentUses || 0), 0);
            
            // Calculate total savings
            let totalSavings = 0;
            employeeCodes.filter(c => c.used).forEach(c => {
                totalSavings += c.packagePrice;
            });
            marketingCodes.forEach(c => {
                const uses = c.currentUses || 0;
                if (c.discountType === 'percentage') {
                    totalSavings += uses * (99 * (c.discountValue / 100)); // Estimate based on average package price
                } else if (c.discountType === 'fixed') {
                    totalSavings += uses * c.discountValue;
                } else if (c.discountType === 'free') {
                    totalSavings += uses * 99; // Average package price
                }
            });

            document.getElementById('totalCodes').textContent = totalCodes;
            document.getElementById('activeCodes').textContent = activeCodes;
            document.getElementById('usedCodes').textContent = usedCount;
            document.getElementById('totalSavings').textContent = '$' + Math.round(totalSavings).toLocaleString();
        }

        // Update codes table
        function updateCodesTable() {
            const tableBody = document.getElementById('codesTableBody');
            tableBody.innerHTML = '';

            // Add employee codes
            employeeCodes.forEach(code => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td><strong>${code.code}</strong></td>
                    <td>Employee</td>
                    <td>100% (${code.packageType})</td>
                    <td>${code.used ? '1/1' : '0/1'}</td>
                    <td>${code.packageType}</td>
                    <td>No Expiry</td>
                    <td><span style="color: ${code.status === 'active' ? 'green' : '#666'}">${code.status}</span></td>
                    <td>
                        <button class="btn-secondary" onclick="viewCodeDetails('${code.code}', 'employee')">Details</button>
                        ${code.status === 'active' ? `<button class="btn-secondary" onclick="deactivateCode('${code.code}', 'employee')">Deactivate</button>` : ''}
                    </td>
                `;
            });

            // Add marketing codes
            marketingCodes.forEach(code => {
                const row = tableBody.insertRow();
                let usageDisplay = code.usageType === 'unlimited' ? `${code.currentUses}/‚àû` : `${code.currentUses}/${code.maxUses}`;
                let discountDisplay = code.discountType === 'percentage' ? `${code.discountValue}%` : 
                                    code.discountType === 'fixed' ? `$${code.discountValue}` : '100%';
                
                row.innerHTML = `
                    <td><strong>${code.code}</strong></td>
                    <td>Marketing</td>
                    <td>${discountDisplay}</td>
                    <td>${usageDisplay}</td>
                    <td>All</td>
                    <td>${code.expires ? new Date(code.expires).toLocaleDateString() : 'No Expiry'}</td>
                    <td><span style="color: ${code.status === 'active' ? 'green' : '#666'}">${code.status}</span></td>
                    <td>
                        <button class="btn-secondary" onclick="viewCodeDetails('${code.code}', 'marketing')">Details</button>
                        ${code.status === 'active' ? `<button class="btn-secondary" onclick="deactivateCode('${code.code}', 'marketing')">Deactivate</button>` : ''}
                    </td>
                `;
            });
        }

        // Update analytics
        function updateAnalytics() {
            // Calculate revenue metrics
            const usedEmployeeCodes = employeeCodes.filter(c => c.used).length;
            const totalMarketingUses = marketingCodes.reduce((sum, c) => sum + (c.currentUses || 0), 0);
            const totalSales = usedEmployeeCodes + totalMarketingUses + 15; // Add some organic sales
            
            const monthlyRevenue = totalSales * 94 + Math.floor(Math.random() * 500) + 2000;
            const totalRevenue = monthlyRevenue * 3.2; // Extrapolate
            const activeCustomers = totalSales + Math.floor(Math.random() * 20) + 25;
            const completionRate = Math.min(95, 78 + Math.floor(Math.random() * 15));
            const arpu = Math.round(totalRevenue / activeCustomers);

            // Update Essential Analytics
            document.getElementById('monthlyRevenue').textContent = '$' + monthlyRevenue.toLocaleString();
            document.getElementById('activeCustomers').textContent = activeCustomers.toLocaleString();
            document.getElementById('completionRate').textContent = completionRate + '%';
            document.getElementById('arpu').textContent = '$' + arpu;

            // Update Revenue Analytics
            document.getElementById('totalRevenue').textContent = '$' + Math.round(totalRevenue).toLocaleString();
            document.getElementById('ptRevenue').textContent = '$' + Math.round(totalRevenue * 0.45).toLocaleString();
            document.getElementById('otRevenue').textContent = '$' + Math.round(totalRevenue * 0.32).toLocaleString();
            
            // Calculate discount savings
            let discountSavings = 0;
            employeeCodes.filter(c => c.used).forEach(c => discountSavings += c.packagePrice);
            marketingCodes.forEach(c => {
                const uses = c.currentUses || 0;
                if (c.discountType === 'percentage') {
                    discountSavings += uses * (99 * (c.discountValue / 100));
                } else if (c.discountType === 'fixed') {
                    discountSavings += uses * c.discountValue;
                } else if (c.discountType === 'free') {
                    discountSavings += uses * 99;
                }
            });
            document.getElementById('totalDiscountSavings').textContent = '$' + Math.round(discountSavings).toLocaleString();

            // Update Customer Analytics
            document.getElementById('totalCustomers').textContent = activeCustomers + Math.floor(Math.random() * 10) + 5;
            document.getElementById('newCustomers').textContent = Math.floor(activeCustomers * 0.25) + Math.floor(Math.random() * 5);
            document.getElementById('retentionRate').textContent = (85 + Math.floor(Math.random() * 10)) + '%';
            document.getElementById('popularPackage').textContent = 'PT';

            // Update Marketing Analytics
            const totalPossibleUses = totalSales + Math.floor(Math.random() * 20) + 30;
            const discountUsage = Math.round(((usedEmployeeCodes + totalMarketingUses) / totalPossibleUses) * 100);
            document.getElementById('discountUsage').textContent = discountUsage + '%';
            
            // Find most used marketing code
            let topCode = marketingCodes.length > 0 ? marketingCodes.reduce((a, b) => 
                (a.currentUses || 0) > (b.currentUses || 0) ? a : b) : null;
            document.getElementById('topCode').textContent = topCode ? topCode.code : '-';
            
            document.getElementById('marketingConversion').textContent = (discountUsage * 0.8) + '%';
            
            const employeeUsageRate = employeeCodes.length > 0 ? 
                Math.round((employeeCodes.filter(c => c.used).length / employeeCodes.length) * 100) : 0;
            document.getElementById('employeeRedemption').textContent = employeeUsageRate + '%';
        }

        // Employee form submission
        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('employeeName').value;
            const employeeType = document.getElementById('employeeType').value;
            const packageType = document.getElementById('employeePackage').value;
            const notes = document.getElementById('employeeNotes').value;
            
            if (!employeeName || !employeeType || !packageType) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Generate unique code
            const codePrefix = packageType + '-EMP';
            const codeNumber = String(Math.floor(Math.random() * 9000) + 1000);
            const newCode = codePrefix + codeNumber;
            
            // Get package price
            const packagePrices = { 'PT': 109, 'PTA': 89, 'OT': 109, 'COTA': 89 };
            
            const employeeCode = {
                code: newCode,
                employeeName: employeeName,
                employeeType: employeeType,
                packageType: packageType,
                packagePrice: packagePrices[packageType],
                notes: notes,
                status: 'active',
                created: new Date().toISOString(),
                used: false
            };
            
            employeeCodes.push(employeeCode);
            saveData();
            updateCodeStats();
            updateCodesTable();
            
            // Show success message
            const successDiv = document.getElementById('codeSuccess');
            successDiv.innerHTML = `‚úÖ Employee code <strong>${newCode}</strong> created successfully for ${employeeName}!`;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 5000);
            
            // Clear form
            this.reset();
        });

        // Marketing form submission
        document.getElementById('marketingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const codeName = document.getElementById('marketingCodeName').value.toUpperCase();
            const discountType = document.getElementById('marketingDiscountType').value;
            const discountValue = document.getElementById('marketingDiscountValue').value;
            const usageType = document.getElementById('marketingUsageType').value;
            const maxUses = document.getElementById('marketingMaxUses').value;
            const expiry = document.getElementById('marketingExpiry').value;
            const campaign = document.getElementById('marketingCampaign').value;
            
            if (!codeName || !discountType || (!discountValue && discountType !== 'free')) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Check for duplicate codes
            if (marketingCodes.find(c => c.code === codeName) || employeeCodes.find(c => c.code === codeName)) {
                alert('Code name already exists. Please choose a different name.');
                return;
            }
            
            const marketingCode = {
                code: codeName,
                discountType: discountType,
                discountValue: discountType === 'free' ? 100 : parseInt(discountValue),
                usageType: usageType,
                maxUses: usageType === 'limited' ? parseInt(maxUses) : null,
                currentUses: 0,
                campaign: campaign || 'General Campaign',
                expires: expiry || null,
                status: 'active',
                created: new Date().toISOString()
            };
            
            marketingCodes.push(marketingCode);
            saveData();
            updateCodeStats();
            updateCodesTable();
            
            // Show success message
            const successDiv = document.getElementById('codeSuccess');
            successDiv.innerHTML = `üöÄ Marketing code <strong>${codeName}</strong> created successfully!`;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 5000);
            
            // Clear form
            this.reset();
        });

        // Settings form submission
        document.getElementById('settingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('newPassword').value;
            const notifications = document.getElementById('emailNotifications').value;
            
            // Save settings
            const settings = {
                username: username,
                notifications: notifications,
                updated: new Date().toISOString()
            };
            
            if (password) {
                settings.password = password;
            }
            
            localStorage.setItem('drTroyAdminSettings', JSON.stringify(settings));
            
            // Show success
            const successDiv = document.getElementById('settingsSuccess');
            successDiv.innerHTML = '‚úÖ Settings updated successfully!';
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
            
            // Clear password field
            document.getElementById('newPassword').value = '';
        });

        // Code management functions
        function viewCodeDetails(code, type) {
            const codeData = type === 'employee' ? 
                employeeCodes.find(c => c.code === code) : 
                marketingCodes.find(c => c.code === code);
            
            if (codeData) {
                alert(`Code Details:\n\nCode: ${codeData.code}\nType: ${type}\nStatus: ${codeData.status}\nCreated: ${new Date(codeData.created).toLocaleString()}\n${type === 'employee' ? `Employee: ${codeData.employeeName}` : `Campaign: ${codeData.campaign}`}`);
            }
        }

        function deactivateCode(code, type) {
            if (confirm(`Are you sure you want to deactivate code ${code}?`)) {
                if (type === 'employee') {
                    const codeData = employeeCodes.find(c => c.code === code);
                    if (codeData) codeData.status = 'inactive';
                } else {
                    const codeData = marketingCodes.find(c => c.code === code);
                    if (codeData) codeData.status = 'inactive';
                }
                saveData();
                updateCodeStats();
                updateCodesTable();
            }
        }

        // Data management functions
        function exportAllData() {
            const exportData = {
                employeeCodes: employeeCodes,
                marketingCodes: marketingCodes,
                analytics: analytics,
                exported: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `drtroy-admin-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Data exported successfully!');
        }

        function clearAnalytics() {
            if (confirm('This will clear all analytics data. Are you sure?')) {
                analytics = {};
                localStorage.removeItem('drTroyAnalytics');
                updateAnalytics();
                alert('‚úÖ Analytics data cleared!');
            }
        }

        function resetCodes() {
            if (confirm('This will reset to sample codes and clear all your custom codes. Are you sure?')) {
                employeeCodes = [];
                marketingCodes = [];
                createSampleData();
                updateCodeStats();
                updateCodesTable();
                alert('‚úÖ Sample codes restored!');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdmin();
            console.log('üéØ DrTroy Admin Panel ready to use!');
        });
    </script>
</body>
</html>
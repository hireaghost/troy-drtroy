<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account | DrTroy.com</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --navy: #1a365d;
            --gold: #d69e2e;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --success: #059669;
            --danger: #dc2626;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: #f8f6f0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .logo img {
            height: 200px;
            width: auto;
            max-width: 800px;
        }

        .nav {
            margin-top: 1rem;
        }

        .nav a {
            color: var(--gray-600);
            text-decoration: none;
            margin: 0 1.5rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav a:hover {
            color: var(--navy);
        }

        .login-link {
            background: var(--gold) !important;
            color: var(--navy) !important;
            padding: 0.5rem 1rem !important;
            border-radius: 6px !important;
            font-weight: 600 !important;
            text-decoration: none !important;
            margin-left: 1rem !important;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--gray-600);
            font-size: 1.1rem;
        }

        /* Login Required */
        .login-required {
            background: white;
            border: 2px solid var(--gold);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            max-width: 600px;
            margin: 2rem auto;
        }

        .login-required h2 {
            color: var(--navy);
            margin-bottom: 1rem;
        }

        .login-required p {
            color: var(--gray-600);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        /* Account Layout */
        .account-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .sidebar h3 {
            color: var(--navy);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 0.5rem;
        }

        .sidebar a {
            display: block;
            padding: 0.75rem 1rem;
            color: var(--gray-600);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .sidebar a:hover {
            background: var(--gray-50);
            color: var(--navy);
        }

        .sidebar a.active {
            background: var(--navy);
            color: white;
        }

        /* Main Content */
        .main-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .content-section {
            display: none;
            padding: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .content-section h2 {
            color: var(--navy);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .content-section p {
            color: var(--gray-600);
            margin-bottom: 2rem;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select {
            padding: 0.75rem;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        .form-input[readonly] {
            background: var(--gray-50);
            color: var(--gray-600);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--navy);
            color: white;
        }

        .btn-primary:hover {
            background: #1e40af;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* CCU Dashboard */
        .ccu-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .ccu-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .ccu-card h4 {
            color: var(--gray-600);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ccu-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--navy);
        }

        /* Progress Bar */
        .progress-container {
            margin: 1.5rem 0;
        }

        .progress-bar {
            background: var(--gray-200);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #dcfce7;
            border: 1px solid var(--success);
            color: #065f46;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #d97706;
            color: #92400e;
        }

        .alert-danger {
            background: #fef2f2;
            border: 1px solid var(--danger);
            color: #991b1b;
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        /* Emergency Access styles removed per user request */

        /* Responsive */
        @media (max-width: 768px) {
            .account-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .sidebar {
                position: static;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .ccu-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <a href="index.html">
                    <img src="courses/images/drtroy_logo.png" alt="DrTroy Continuing Education">
                </a>
            </div>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="courses.html">Courses</a>
                <a href="pricing.html">Pricing</a>
                <a href="#contact">Contact</a>
                <a href="my-account.html" class="login-link" id="accountLink">My Account</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Login Required Message -->
        <div id="loginRequired" class="login-required" style="display: none;">
            <h2>üîê Account Access Required</h2>
            <p>Please log in or create an account to access your account dashboard.</p>
            <p style="color: var(--gray-600); margin-top: 1rem;">If you're having trouble logging in, please return to the home page and try again.</p>
            <a href="index.html" class="btn btn-primary">Go to Home Page</a>
        </div>

        <!-- Account Content -->
        <div id="accountContent" style="display: none;">
            <div class="page-header">
                <h1>My Account</h1>
                <p>Manage your continuing education journey</p>
            </div>

            <div class="account-layout">
                <!-- Sidebar Navigation -->
                <div class="sidebar">
                    <h3>Account Menu</h3>
                    <ul>
                        <li><a href="#" onclick="showSection('overview')" class="nav-link active">üìä Overview</a></li>
                        <li><a href="#" onclick="showSection('personal')" class="nav-link">üë§ Personal Info</a></li>
                        <li><a href="#" onclick="showSection('password')" class="nav-link">üîê Password</a></li>
                        <li><a href="#" onclick="showSection('ccu')" class="nav-link">üéì CCU Dashboard</a></li>
                        <li><a href="#" onclick="showSection('courses')" class="nav-link">üìö My Courses</a></li>
                        <li><a href="#" onclick="showSection('notifications')" class="nav-link">üîî Notifications</a></li>
                        <li><a href="#" onclick="showSection('security')" class="nav-link">üõ°Ô∏è Security</a></li>
                        <li><a href="#" onclick="showSection('privacy')" class="nav-link">üîí Privacy</a></li>
                        <li><a href="#" onclick="showSection('settings')" class="nav-link">‚öôÔ∏è Settings</a></li>
                    </ul>
                </div>

                <!-- Main Content Area -->
                <div class="main-content">
                    <!-- Overview Section -->
                    <div id="overview" class="content-section active">
                        <h2>Account Overview</h2>
                        <p>Welcome back! Here's your account summary.</p>
                        
                        <div class="ccu-overview">
                            <div class="ccu-card">
                                <h4>CCUs Required</h4>
                                <div class="value" id="requiredCCUs">27</div>
                            </div>
                            <div class="ccu-card">
                                <h4>CCUs Earned</h4>
                                <div class="value" id="earnedCCUs">0</div>
                            </div>
                            <div class="ccu-card">
                                <h4>Courses Completed</h4>
                                <div class="value" id="coursesCompleted">0</div>
                            </div>
                            <div class="ccu-card">
                                <h4>License Status</h4>
                                <div class="value" style="font-size: 1rem; color: var(--success);" id="licenseStatus">Current</div>
                            </div>
                        </div>

                        <div class="progress-container">
                            <h3>CCU Progress</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="progressText">0 of 27 CCUs completed (0%)</div>
                        </div>
                    </div>

                    <!-- Personal Info Section -->
                    <div id="personal" class="content-section">
                        <h2>Personal Information</h2>
                        <p>Update your profile and contact information.</p>
                        
                        <form id="personalInfoForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone Number</label>
                                    <input type="tel" id="phone" class="form-input" placeholder="(555) 123-4567">
                                </div>
                                <div class="form-group">
                                    <label for="address">Address</label>
                                    <input type="text" id="address" class="form-input" placeholder="123 Main Street">
                                </div>
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" class="form-input" placeholder="Your City">
                                </div>
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <input type="text" id="state" class="form-input" placeholder="TX" maxlength="2" style="text-transform: uppercase;">
                                </div>
                                <div class="form-group">
                                    <label for="zipCode">ZIP Code</label>
                                    <input type="text" id="zipCode" class="form-input" placeholder="12345" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label for="discipline">Discipline</label>
                                    <select id="discipline" class="form-select" disabled>
                                        <option value="">Select Discipline</option>
                                        <option value="PT">Physical Therapist (PT)</option>
                                        <option value="PTA">Physical Therapist Assistant (PTA)</option>
                                        <option value="OT">Occupational Therapist (OT)</option>
                                        <option value="COTA">Certified OT Assistant (COTA)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="licenseNumber">License Number</label>
                                    <input type="text" id="licenseNumber" class="form-input" placeholder="Your license number">
                                </div>
                                <div class="form-group">
                                    <label for="licenseState">License State</label>
                                    <input type="text" id="licenseState" class="form-input" placeholder="TX" maxlength="2" style="text-transform: uppercase;">
                                </div>
                                <div class="form-group">
                                    <label for="licenseExpiration">License Expiration</label>
                                    <input type="date" id="licenseExpiration" class="form-input">
                                </div>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="renewalReminders" checked>
                                <label for="renewalReminders">Send me email reminders when my license is close to expiring</label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                        </form>
                    </div>

                    <!-- Password Section -->
                    <div id="password" class="content-section">
                        <h2>Change Password</h2>
                        <p>Update your account password for security.</p>
                        
                        <form id="passwordForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input type="password" id="currentPassword" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input type="password" id="newPassword" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" class="form-input" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">üîê Change Password</button>
                        </form>
                    </div>

                    <!-- CCU Dashboard Section -->
                    <div id="ccu" class="content-section">
                        <h2>CCU Dashboard</h2>
                        <p>Track your continuing education progress and requirements.</p>
                        
                        <div class="ccu-overview">
                            <div class="ccu-card">
                                <h4>Required This Period</h4>
                                <div class="value" id="ccuRequired">27</div>
                            </div>
                            <div class="ccu-card">
                                <h4>Currently Earned</h4>
                                <div class="value" id="ccuEarned">0</div>
                            </div>
                            <div class="ccu-card">
                                <h4>Remaining</h4>
                                <div class="value" id="ccuRemaining">27</div>
                            </div>
                            <div class="ccu-card">
                                <h4>Days Until Renewal</h4>
                                <div class="value" id="daysUntilRenewal">--</div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <h3>Progress to License Renewal</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" id="ccuProgressFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="ccuProgressText">0 of 27 CCUs completed (0%)</div>
                        </div>
                        
                        <div style="margin-top: 2rem;">
                            <h3>Course History</h3>
                            <div id="courseHistory">
                                <p style="text-align: center; color: var(--gray-600); padding: 2rem;">Complete courses to see your CCU history here</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button onclick="printCCUTranscript()" class="btn btn-secondary">üìÑ Print CCU Transcript</button>
                            <a href="courses.html" class="btn btn-primary">üìö Browse Courses</a>
                        </div>
                    </div>

                    <!-- My Courses Section -->
                    <div id="courses" class="content-section">
                        <h2>My Courses</h2>
                        <p>View your enrolled and completed courses.</p>
                        
                        <div id="coursesList">
                            <div style="text-align: center; color: var(--gray-600); padding: 3rem;">
                                <h3>No Courses Yet</h3>
                                <p>You haven't enrolled in any courses yet.</p>
                                <a href="courses.html" class="btn btn-primary" style="margin-top: 1rem;">üìö Browse Available Courses</a>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Section -->
                    <div id="notifications" class="content-section">
                        <h2>Notification Preferences</h2>
                        <p>Control how and when you receive updates.</p>
                        
                        <form id="notificationsForm">
                            <h3 style="margin-bottom: 1rem;">Email Notifications</h3>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="emailCourseUpdates" checked>
                                <label for="emailCourseUpdates">Course updates and new content</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="emailLicenseReminders" checked>
                                <label for="emailLicenseReminders">License renewal reminders</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="emailPromotions">
                                <label for="emailPromotions">Promotions and special offers</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="emailWeeklyDigest">
                                <label for="emailWeeklyDigest">Weekly digest of platform activity</label>
                            </div>
                            
                            <button type="button" onclick="saveNotificationPreferences()" class="btn btn-primary">üíæ Save Preferences</button>
                        </form>
                    </div>

                    <!-- Security Section -->
                    <div id="security" class="content-section">
                        <h2>Security Settings</h2>
                        <p>Manage your account security and login settings.</p>
                        
                        <div style="background: var(--gray-50); padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3>Two-Factor Authentication</h3>
                            <p style="color: var(--gray-600); margin: 1rem 0;">Add an extra layer of security to your account.</p>
                            <button class="btn btn-secondary">üîê Enable 2FA (Coming Soon)</button>
                        </div>
                        
                        <div style="background: var(--gray-50); padding: 2rem; border-radius: 8px;">
                            <h3>Recent Login Activity</h3>
                            <div id="loginActivity">
                                <p style="color: var(--gray-600); text-align: center; padding: 2rem;">No recent login activity recorded</p>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Section -->
                    <div id="privacy" class="content-section">
                        <h2>Privacy & Data</h2>
                        <p>Manage your privacy settings and data preferences.</p>
                        
                        <form id="privacyForm">
                            <h3 style="margin-bottom: 1rem;">Data Usage</h3>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="dataAnalytics" checked>
                                <label for="dataAnalytics">Allow anonymous usage analytics to improve the platform</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="marketingConsent">
                                <label for="marketingConsent">Consent to marketing communications</label>
                            </div>
                            
                            <button type="button" onclick="savePrivacySettings()" class="btn btn-primary">üíæ Save Privacy Settings</button>
                        </form>
                        
                        <div style="margin-top: 3rem; padding: 2rem; border: 1px solid var(--gray-200); border-radius: 8px;">
                            <h3>Data Export & Deletion</h3>
                            <p style="color: var(--gray-600); margin: 1rem 0;">Export your data or delete your account permanently.</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button onclick="exportAccountData()" class="btn btn-secondary">üì• Export My Data</button>
                                <button onclick="requestAccountDeletion()" class="btn btn-danger">üóëÔ∏è Delete Account</button>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settings" class="content-section">
                        <h2>Account Settings</h2>
                        <p>Customize your account preferences and interface.</p>
                        
                        <div style="background: var(--gray-50); padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3>Interface Preferences</h3>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="darkMode">
                                <label for="darkMode">Enable dark mode (Coming Soon)</label>
                            </div>
                        </div>
                        
                        <div style="background: var(--gray-50); padding: 2rem; border-radius: 8px;">
                            <h3>Account Actions</h3>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                                <button onclick="logout()" class="btn btn-secondary">üö™ Logout</button>
                                <a href="courses.html" class="btn btn-primary">üìö Browse Courses</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentAccount = null;

        // Initialize page when loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('My Account page initializing...');
            checkLoginStatus();
            setupEventListeners();
        });

        // Check if user is logged in
        function checkLoginStatus() {
            console.log('Checking login status...');
            
            const accountData = localStorage.getItem('drtroyAccount');
            const sessionData = localStorage.getItem('userSession');
            
            if (accountData && sessionData) {
                try {
                    currentAccount = JSON.parse(accountData);
                    const session = JSON.parse(sessionData);
                    
                    // Check if session is still valid
                    if (session.expires > Date.now()) {
                        console.log('User is logged in:', currentAccount.firstName);
                        showAccountContent();
                        loadAccountData();
                    } else {
                        console.log('Session expired');
                        showLoginRequired();
                    }
                } catch (error) {
                    console.error('Error parsing account data:', error);
                    showLoginRequired();
                }
            } else {
                console.log('No account or session found');
                showLoginRequired();
            }
        }

        // Show account content
        function showAccountContent() {
            document.getElementById('loginRequired').style.display = 'none';
            document.getElementById('accountContent').style.display = 'block';
        }

        // Show login required message
        function showLoginRequired() {
            document.getElementById('loginRequired').style.display = 'block';
            document.getElementById('accountContent').style.display = 'none';
            
            // Redirect after 5 seconds
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 5000);
        }

        // Load account data into forms
        function loadAccountData() {
            if (!currentAccount) return;
            
            console.log('Loading account data...');
            
            // Personal information
            document.getElementById('firstName').value = currentAccount.firstName || '';
            document.getElementById('lastName').value = currentAccount.lastName || '';
            document.getElementById('email').value = currentAccount.email || '';
            document.getElementById('phone').value = currentAccount.phone || '';
            document.getElementById('address').value = currentAccount.address || '';
            document.getElementById('city').value = currentAccount.city || '';
            document.getElementById('state').value = currentAccount.state || '';
            document.getElementById('zipCode').value = currentAccount.zipCode || '';
            document.getElementById('discipline').value = currentAccount.discipline || '';
            document.getElementById('licenseNumber').value = currentAccount.licenseNumber || '';
            document.getElementById('licenseState').value = currentAccount.licenseState || '';
            document.getElementById('licenseExpiration').value = currentAccount.licenseExpiration || '';
            document.getElementById('renewalReminders').checked = currentAccount.licenseRenewalReminders !== false;
            
            // Load notification preferences
            if (currentAccount.notifications) {
                document.getElementById('emailCourseUpdates').checked = currentAccount.notifications.courseUpdates !== false;
                document.getElementById('emailLicenseReminders').checked = currentAccount.notifications.licenseReminders !== false;
                document.getElementById('emailPromotions').checked = currentAccount.notifications.promotions === true;
                document.getElementById('emailWeeklyDigest').checked = currentAccount.notifications.weeklyDigest === true;
            }
            
            // Load privacy settings
            if (currentAccount.privacy) {
                document.getElementById('dataAnalytics').checked = currentAccount.privacy.dataAnalytics !== false;
                document.getElementById('marketingConsent').checked = currentAccount.privacy.marketingConsent === true;
            }
            
            // Update CCU dashboard
            updateCCUDashboard();
        }

        // Update CCU dashboard
        function updateCCUDashboard() {
            if (!currentAccount) return;
            
            const discipline = currentAccount.discipline || 'PT';
            const ccuRequirements = {
                'PT': 27,
                'PTA': 17,
                'OT': 23,
                'COTA': 23
            };
            
            const required = ccuRequirements[discipline] || 27;
            const earned = 0; // Would come from completed courses
            const remaining = Math.max(0, required - earned);
            const percentage = Math.min(100, (earned / required) * 100);
            
            // Update displays
            document.getElementById('requiredCCUs').textContent = required;
            document.getElementById('earnedCCUs').textContent = earned;
            document.getElementById('ccuRequired').textContent = required;
            document.getElementById('ccuEarned').textContent = earned;
            document.getElementById('ccuRemaining').textContent = remaining;
            
            // Update progress bars
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('ccuProgressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${earned} of ${required} CCUs completed (${Math.round(percentage)}%)`;
            document.getElementById('ccuProgressText').textContent = `${earned} of ${required} CCUs completed (${Math.round(percentage)}%)`;
            
            // Calculate days until renewal if expiration date is set
            if (currentAccount.licenseExpiration) {
                const expirationDate = new Date(currentAccount.licenseExpiration);
                const today = new Date();
                const daysUntil = Math.ceil((expirationDate - today) / (1000 * 60 * 60 * 24));
                document.getElementById('daysUntilRenewal').textContent = daysUntil > 0 ? daysUntil : 'Expired';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Personal info form
            document.getElementById('personalInfoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                savePersonalInfo();
            });
            
            // Password form
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                changePassword();
            });
            
            // Auto-uppercase state fields
            document.getElementById('state').addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
            
            document.getElementById('licenseState').addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
        }

        // Save personal information
        function savePersonalInfo() {
            if (!currentAccount) return;
            
            console.log('Saving personal information...');
            
            // Update account data
            currentAccount.firstName = document.getElementById('firstName').value;
            currentAccount.lastName = document.getElementById('lastName').value;
            currentAccount.email = document.getElementById('email').value;
            currentAccount.phone = document.getElementById('phone').value;
            currentAccount.address = document.getElementById('address').value;
            currentAccount.city = document.getElementById('city').value;
            currentAccount.state = document.getElementById('state').value.toUpperCase();
            currentAccount.zipCode = document.getElementById('zipCode').value;
            currentAccount.licenseNumber = document.getElementById('licenseNumber').value;
            currentAccount.licenseState = document.getElementById('licenseState').value.toUpperCase();
            currentAccount.licenseExpiration = document.getElementById('licenseExpiration').value;
            currentAccount.licenseRenewalReminders = document.getElementById('renewalReminders').checked;
            currentAccount.updatedAt = new Date().toISOString();
            
            // Save to localStorage
            localStorage.setItem('drtroyAccount', JSON.stringify(currentAccount));
            
            // Update other localStorage items
            localStorage.setItem('customerName', `${currentAccount.firstName} ${currentAccount.lastName}`);
            localStorage.setItem('customerEmail', currentAccount.email);
            
            showAlert('Personal information updated successfully!', 'success');
            updateCCUDashboard();
        }

        // Change password
        function changePassword() {
            if (!currentAccount) return;
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate current password
            if (currentAccount.password !== currentPassword) {
                showAlert('Current password is incorrect.', 'danger');
                return;
            }
            
            // Validate new passwords match
            if (newPassword !== confirmPassword) {
                showAlert('New passwords do not match.', 'danger');
                return;
            }
            
            // Update password
            currentAccount.password = newPassword;
            currentAccount.updatedAt = new Date().toISOString();
            
            // Save to localStorage
            localStorage.setItem('drtroyAccount', JSON.stringify(currentAccount));
            
            // Clear form
            document.getElementById('passwordForm').reset();
            
            showAlert('Password changed successfully!', 'success');
        }

        // Save notification preferences
        function saveNotificationPreferences() {
            if (!currentAccount) return;
            
            currentAccount.notifications = {
                courseUpdates: document.getElementById('emailCourseUpdates').checked,
                licenseReminders: document.getElementById('emailLicenseReminders').checked,
                promotions: document.getElementById('emailPromotions').checked,
                weeklyDigest: document.getElementById('emailWeeklyDigest').checked
            };
            
            currentAccount.updatedAt = new Date().toISOString();
            localStorage.setItem('drtroyAccount', JSON.stringify(currentAccount));
            
            showAlert('Notification preferences saved!', 'success');
        }

        // Save privacy settings
        function savePrivacySettings() {
            if (!currentAccount) return;
            
            currentAccount.privacy = {
                dataAnalytics: document.getElementById('dataAnalytics').checked,
                marketingConsent: document.getElementById('marketingConsent').checked
            };
            
            currentAccount.updatedAt = new Date().toISOString();
            localStorage.setItem('drtroyAccount', JSON.stringify(currentAccount));
            
            showAlert('Privacy settings saved!', 'success');
        }

        // Export account data
        function exportAccountData() {
            if (!currentAccount) return;
            
            const exportData = {
                ...currentAccount,
                exportDate: new Date().toISOString(),
                dataVersion: '2.0'
            };
            
            const dataBlob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `drtroy-account-${currentAccount.firstName}-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showAlert('Account data exported successfully!', 'success');
        }

        // Request account deletion
        function requestAccountDeletion() {
            if (confirm('‚ö†Ô∏è Are you sure you want to delete your account?\n\nThis action cannot be undone and will permanently remove:\n‚Ä¢ All your personal information\n‚Ä¢ Course progress and certificates\n‚Ä¢ Account settings and preferences')) {
                if (confirm('üö® FINAL WARNING: This will permanently delete everything.\n\nType "DELETE" in the next prompt to confirm.')) {
                    const confirmation = prompt('Type "DELETE" to permanently delete your account:');
                    if (confirmation === 'DELETE') {
                        // Clear all data
                        localStorage.removeItem('drtroyAccount');
                        localStorage.removeItem('userSession');
                        localStorage.removeItem('customerName');
                        localStorage.removeItem('customerEmail');
                        localStorage.removeItem('customerDiscipline');
                        
                        alert('‚úÖ Account deleted successfully. You will be redirected to the homepage.');
                        window.location.href = 'index.html';
                    } else {
                        alert('Account deletion cancelled - confirmation text did not match.');
                    }
                }
            }
        }

        // Print CCU transcript
        function printCCUTranscript() {
            if (!currentAccount) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>CCU Transcript - ${currentAccount.firstName} ${currentAccount.lastName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 2rem; }
                        .header { border-bottom: 2px solid #1a365d; padding-bottom: 1rem; margin-bottom: 2rem; }
                        .info-table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
                        .info-table td { padding: 0.5rem; border-bottom: 1px solid #e5e7eb; }
                        .course-table { width: 100%; border-collapse: collapse; }
                        .course-table th, .course-table td { padding: 0.8rem; border: 1px solid #d1d5db; text-align: left; }
                        .course-table th { background: #f3f4f6; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Continuing Education Transcript</h1>
                        <h2>DrTroy.com Professional Development</h2>
                    </div>
                    <table class="info-table">
                        <tr><td><strong>Name:</strong></td><td>${currentAccount.firstName} ${currentAccount.lastName}</td></tr>
                        <tr><td><strong>Email:</strong></td><td>${currentAccount.email}</td></tr>
                        <tr><td><strong>License Number:</strong></td><td>${currentAccount.licenseNumber || 'Not provided'}</td></tr>
                        <tr><td><strong>License State:</strong></td><td>${currentAccount.licenseState || 'Not provided'}</td></tr>
                        <tr><td><strong>Discipline:</strong></td><td>${currentAccount.discipline || 'Not provided'}</td></tr>
                        <tr><td><strong>License Expiration:</strong></td><td>${currentAccount.licenseExpiration ? new Date(currentAccount.licenseExpiration).toLocaleDateString() : 'Not provided'}</td></tr>
                        <tr><td><strong>Transcript Generated:</strong></td><td>${new Date().toLocaleDateString()}</td></tr>
                    </table>
                    <h3>Course Completion History</h3>
                    <table class="course-table">
                        <thead>
                            <tr>
                                <th>Course Title</th>
                                <th>Completion Date</th>
                                <th>CCUs Earned</th>
                                <th>Certificate ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="4" style="text-align: center; padding: 2rem; color: #6b7280;">No completed courses on record</td></tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 3rem; font-size: 0.9rem; color: #6b7280;">
                        <p>This transcript is generated from DrTroy.com and reflects courses completed through our platform.</p>
                        <p>For verification purposes, contact: troyh@texastherapypros.com</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('userSession');
                localStorage.removeItem('customerName');
                localStorage.removeItem('customerEmail');
                localStorage.removeItem('customerDiscipline');
                
                window.location.href = 'index.html';
            }
        }

        // Emergency account function removed per user request

        // Show alert message
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // Find the active section and prepend the alert
            const activeSection = document.querySelector('.content-section.active');
            if (activeSection) {
                activeSection.insertBefore(alertDiv, activeSection.firstChild);
                
                // Remove alert after 5 seconds
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        }
    </script>
</body>
</html>